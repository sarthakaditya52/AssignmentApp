"use strict";var express=require("express"),router=express.Router(),config=require("config"),bodyParser=require("body-parser");router.use(bodyParser.urlencoded({extended:!1})),router.use(bodyParser.json());var Assignment=require("../../model/Assignment"),Course=require("../../model/Course");router.get("/createAssignments",function(e,n){n.render("addAssignment")}),router.post("/createAssignments",function(t,i){var e=t.body.name;Course.findOne({name:e}).then(function(e,n){if(n)console.log(n);else if(e){assignment=new Assignment,assignment.task=t.body.task,assignment.day=t.body.day;for(var s=0;s<e.assignments.length;s++)e.assignments[s].day==t.body.day&&e.assignments.splice(s,1);e.assignments.push(assignment),e.assignments.sort(function(e,n){return e.day-n.day})}else assignment=new Assignment,(e=new Course).name=t.body.name,assignment.task=t.body.task,assignment.day=t.body.day,e.assignments.push(assignment);e.save(function(e){e?console.log(e):i.render("index",{title:"Assignment Added"})})})}),router.get("/Assignments",function(e,s){Course.find({},function(e,n){e?console.log(e):s.render("viewAssignments",{title:"Assignments",courses:n})})}),router.get("/Assignment/:id",function(r,a){Course.find({},function(e,n){if(e)console.log(e);else{assignment=new Assignment;for(var s="",t=0;t<n.length;t++)for(var i=0;i<n[t].assignments.length;i++)if(n[t].assignments[i]._id==r.params.id){assignment=n[t].assignments[i],s=n[t].name,i=n[t].assignments.length+1,t=n.length+1;break}a.render("updateAssignment",{title:"Edit or Remove Assignment",course:s,assignment:assignment})}})}),router.post("/deleteAssignment/:id",function(r,a){var o=null,g={},d=!1;Course.find({},function(e,n){if(e)console.log(e);else{for(var s=0;s<n.length;s++)for(var t=0;t<n[s].assignments.length;t++)if(n[s].assignments[t]._id==r.params.id){n[s].assignments.splice(t,1),n[s].assignments.length<1&&(d=!0),o=n[s]._id,g.name=n[s].name,g.assignments=n[s].assignments,t=n[s].assignments.length+1,s=n.length+1;break}var i={_id:o};d?Course.deleteOne(i,function(e){e?console.log(e):a.render("index",{title:"Course Deleted"})}):Course.updateOne(i,g,function(e){e?console.log(e):a.render("index",{title:"Assignment Deleted"})})}})}),router.post("/updateAssignment/:id",function(r,a){var o=null,g={};Course.find({},function(e,n){if(e)console.log(e);else{for(var s=0;s<n.length;s++)for(var t=0;t<n[s].assignments.length;t++)if(n[s].assignments[t]._id==r.params.id){n[s].assignments.splice(t,1),o=n[s]._id,assignment=new Assignment,assignment.task=r.body.task,assignment.day=r.body.day,n[s].assignments.push(assignment),n[s].assignments.sort(function(e,n){return e.day-n.day}),g.name=n[s].name,g.assignments=n[s].assignments,t=n[s].assignments.length+1,s=n.length+1;break}var i={_id:o};Course.updateOne(i,g,function(e){e?console.log(e):a.render("index",{title:"Assignment Updated"})})}})}),module.exports=router;